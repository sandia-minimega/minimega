# Basic plumbing tests
# Note: These test message delivery modes "all" and "round-robin."

.annotate false

# Create basic pipe: test mode all. This is a depth 2 binary tree (to be used for round-robin as well).
plumb p0 p1
plumb p0 p2
plumb p1 p3
plumb p1 p4
plumb p2 p5
plumb p2 p6
plumb
.columns name,mode,readers,writers,count pipe

pipe send p0 "Hello to you."
shell sleep 2s

.columns name,mode,readers,writers,count pipe

# Round-robin mode testing: set all parents to RR and verify message count distributions
pipe name p0 mode round-robin
pipe name p1 mode round-robin
pipe name p2 mode round-robin

pipe send p0 "This is round robin."
pipe send p0 "This is round 2."
pipe send p0 "This is round 3."
pipe send p0 "This is round 4."

.columns name,mode,readers,writers,count pipe
